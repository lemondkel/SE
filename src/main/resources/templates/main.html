<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorator="layout/default-layout">

<!-- main.html 고유 CSS 추가 -->
<th:block layout:fragment="css"/>

<!-- main.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="/smarteditor2/js/service/HuskyEZCreator.js" charset="UTF-8"></script>
	<script type="text/javascript">
		var isPostEnd = false; // Post is ended status
		var isPostIng = false; // Post is ing status
		var oEditors = [];
		$(document).ready(function () {
			nhn.husky.EZCreator.createInIFrame({
				oAppRef: oEditors,
				elPlaceHolder: 'weditor',
				sSkinURI: "/smarteditor2/SmartEditor2Skin.html",
				fCreator: "createSEditor2"
			});

			getBrdPage($('#pageNo').val());

			$(window).scroll(function() {
				if ((parseInt($(window).scrollTop())) > parseInt($(document).height() - $(window).height()) - 300) {
					getBrdPage($('#pageNo').val());
				}
			});
		});

		$('#insertBtn').on('click', function () {
			oEditors.getById.weditor.exec("UPDATE_CONTENTS_FIELD", []);

			if ($('#weditor').val() == "") {
				alert("내용을 입력해주세요.");
				return;
			}

		});

		function getBrdPage(pageNo) {
			if (!isPostEnd && !isPostIng) {
				isPostIng = true;
				$.ajax({
					url: '/brd/get/' + pageNo,
					method: 'GET',
					dataType: "json",
					beforeSend: function () {
					},
					success: function (data) {
						console.log(data);
						$('#pageNo').val(parseInt(pageNo) + 1);
						if (data.code == 0) {
							var list = data.data.selectBrdByPaging;

							for (var i=0; i<list.length; i++) {
								var html = '';
								html += '	<div class="card shadow mb-3">';
								html += '	<div class="card-body">';
								html += '	<div class="d-flex">';
								html += '	<div class="flex-shrink-1">';
								html += '	<img src="https://picsum.photos/200/200?random" class="rounded-circle float-left mr-2" width="60">';
								html += '	</div>';
								html += '	<div class="flex-grow-1">';
								html += '	<h5><a href="#">' + list[i].nickname;
								html += '<small class="text-muted">@' + list[i].userId + '</small>';
								html += '</a></h5>';
								html += list[i].content;
								html += '</div>';
								html += '</div>';
								html += '</div>';
								html += '</div>';
								$('#postList').append(html);
							}

							if (list.length < 10) {
								isPostEnd = true;
							}
						} else {
							isPostEnd = true;
						}
					},
					complete: function () {
						isPostIng = false;
					}
				});
			}
		}
	</script>
</th:block>

<div layout:fragment="content">

	<form name="pagingForm" id="pagingForm">
		<input type="hidden" name="pageNo" id="pageNo" value="1"/>
	</form>

	<div class="container-fluid mt-3">
		<div class="row">
			<div class="col-md-3 mb-3 order-1">
				<div class="card shadow mb-3">
					<img class="card-img-top" src="https://picsum.photos/800/400?image=1019">
					<div class="card-body">
						<div class="row">
							<div class="col-12">
								<img src="https://picsum.photos/200/200?image=718"
									 class="rounded-circle position-absolute my-pic" width="70">
								<h5 class="mb-0"><a href="#" class="text-body">Lorem Ipsum</a></h5>
								<h5><a href="#" class="text-body">
									<small class="text-muted">@LoremIpsum</small>
								</a></h5>
							</div>
							<div class="col-4 text-center">
								<a href="#" class="text-body" data-toggle="tooltip" data-placement="top" title="Posts">
                <span class="fa-layers fa-2x">
                  <i class="far fa-comment-dots"></i>
                  <span class="fa-layers-counter bg-primary fa-layers-bottom-right">123</span>
                </span>
								</a>
							</div>
							<div class="col-4 text-center">
								<a href="#" class="text-body" data-toggle="tooltip" data-placement="top"
								   title="Following">
                <span class="fa-layers fa-2x">
                  <i class="fas fa-user-friends"></i>
                  <span class="fa-layers-counter bg-primary fa-layers-bottom-right">123</span>
                </span>
								</a>
							</div>
							<div class="col-4 text-center">
								<a href="#" class="text-body" data-toggle="tooltip" data-placement="top"
								   title="Followers">
                <span class="fa-layers fa-2x">
                  <i class="fas fa-user-plus"></i>
                  <span class="fa-layers-counter bg-primary fa-layers-bottom-right">789</span>
                </span>
								</a>
							</div>
						</div>
					</div>
				</div>
				<div class="card shadow mb-3">
					<div class="card-body">
						<h5>What's hot</h5>
						<p>Lorem Ipsum<br>
							<small class="text-muted">987 Posts</small>
						</p>
						<p>Lorem Ipsum<br>
							<small class="text-muted">654 Posts</small>
						</p>
						<p>Lorem Ipsum<br>
							<small class="text-muted">321 Posts</small>
						</p>
					</div>
					<div class="card-footer">
						<a href="#">Find more</a>
					</div>
				</div>
			</div>
			<div class="col-md-6 order-3 order-md-2" id="postList">
				<div class="card shadow mb-3">
					<div class="card-body">
						<form id="postingForm" name="postingForm">
							<div class="form-group">
								<textarea cols="3" name="weditor" id="weditor" rows="3"
										  placeholder="What you're doing right now?"></textarea>
							</div>
							<div class="form-group">
								<button class="btn btn-primary" type="button"><i class="fas fa-image"
																				 data-toggle="tooltip"
																				 data-placement="top"
																				 title="Upload an image"></i></button>
								<button class="btn btn-primary float-right" id="insertBtn" type="button"><i
										class="fas fa-comment"></i> Post
								</button>
								<button class="btn btn-link float-right" type="button"><i class="fas fa-times"></i>
									Discard
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="col-md-3 mb-3 order-2 order-md-3">
				<div class="card shadow mb-3">
					<div class="card-body">
						<h5>Recommended</h5>
						<p><img src="https://picsum.photos/200/200?random" class="rounded-circle float-left mr-2"
								width="40">
							<a href="#">Lorem Ipsum
								<small class="text-muted">@LoremIpsum</small>
							</a></p>
						<hr>
						<p><img src="https://picsum.photos/200/200?random" class="rounded-circle float-left mr-2"
								width="40">
							<a href="#">Lorem Ipsum
								<small class="text-muted">@LoremIpsum</small>
							</a></p>
						<hr>
						<p><img src="https://picsum.photos/200/200?random" class="rounded-circle float-left mr-2"
								width="40">
							<a href="#">Lorem Ipsum
								<small class="text-muted">@LoremIpsum</small>
							</a></p>
					</div>
					<div class="card-footer">
						<a href="#">Find more</a>
					</div>
				</div>
				<div class="card shadow">
					<div class="card-body">
						&copy; 2018 Lorem Ipsum <a href="#">Dolor</a> <a href="#">Sit</a> <a href="#">Amet</a>
					</div>
					<div class="card-footer">
						Languages <a href="#">English (UK)</a> <a href="#">English (US)</a> <a href="#">English
						(Aus)</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</html>
